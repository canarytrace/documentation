name: Build & Push documentation

# build only on push to master branch
on:
  push:
    branches: 
    - master
jobs:

  job1:
    name: Build & Push documentation
    runs-on: ubuntu-20.04
    outputs:
      git-tag: ${{ steps.previoustag.outputs.tag }}

    steps:
      -
        name: Checkout Repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      -
        name: 'Get Previous Tag'
        id: previoustag
        uses: "WyriHaximus/github-action-get-previous-tag@master"
      - 
        name: 'Git Tag'
        run: echo ${{steps.previoustag.outputs.tag}}
          
      # Build prod
      -
       name: 'build prod'
       run: |
        npm install
        npm run build
       
      # Sync files
      - name: ðŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.0.0
        with:
          server: ftp.canarytrace.com
          username: ${{ secrets.FTP_USER_PIPELINE }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: './build/'
          server-dir: 'www/'
